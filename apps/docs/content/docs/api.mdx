---
title: API Reference
description: Complete API reference for Databuddy analytics endpoints
---

Access your analytics data programmatically with Databuddy's REST API. All endpoints require authentication and are rate-limited for security.

import { Callout } from "@/components/docs";
import { CodeBlock } from "@/components/docs";

<Callout type="info">
  **Try it live!** Test all these endpoints interactively in our [API
  Playground](/api) with real data and see instant responses. Perfect for
  exploring query types and understanding the API structure.
</Callout>

## Authentication

All API requests require authentication using your session cookies or API key. The API uses the same authentication system as the dashboard.

<CodeBlock 
  language="bash"
  code={`curl -H "Cookie: your-session-cookie" \\
  https://api.databuddy.cc/v1/query`}
/>

## Base URLs

- **Analytics API**: `https://api.databuddy.cc/v1`
- **Event Tracking (Basket)**: `https://basket.databuddy.cc`

## Analytics Query API

### Get Available Query Types

Get all available query types and their configurations.

<CodeBlock 
  language="http"
  code="GET /v1/query/types"
/>

**Parameters:**
- `include_meta` (optional) - Include metadata about query types

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "success": true,
  "data": {
    "summary": {
      "allowedFilters": ["date", "country", "device", "browser"],
      "customizable": true,
      "defaultLimit": 100
    },
    "pages": {
      "allowedFilters": ["date", "path"],
      "customizable": true,
      "defaultLimit": 50
    },
    "traffic": {
      "allowedFilters": ["date", "referrer"],
      "customizable": false,
      "defaultLimit": 100
    }
  }
}`}
/>

### Execute Analytics Query

Execute a specific analytics query with filters and parameters.

<CodeBlock 
  language="http"
  code="POST /v1/query"
/>

**Request:**

<CodeBlock 
  language="json"
  code={`{
  "type": "summary",
  "websiteId": "web_123",
  "startDate": "2024-01-01",
  "endDate": "2024-01-31",
  "timezone": "America/New_York",
  "filters": {
    "country": ["US", "CA"],
    "device": ["desktop"]
  }
}`}
/>

**Available Query Types:**
- `summary` - Overall website metrics and KPIs
- `pages` - Page views and performance data
- `traffic` - Traffic sources and referrers  
- `devices` - Device and browser analytics
- `geo` - Geographic visitor data
- `errors` - JavaScript errors and issues
- `performance` - Web vitals and performance metrics
- `sessions` - Session-based analytics
- `custom_events` - Custom event tracking data
- `profiles` - User profile analytics
- `links` - Outgoing link tracking
- `engagement` - User engagement metrics

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "success": true,
  "data": {
    "results": [
      {
        "date": "2024-01-01",
        "pageviews": 1250,
        "visitors": 890,
        "sessions": 1100
      }
    ],
    "meta": {
      "total": 1,
      "hasMore": false
    }
  }
}`}
/>

### Compile Query (Advanced)

Compile a query to see the generated SQL without executing it.

<CodeBlock 
  language="http"
  code="POST /v1/query/compile"
/>

**Request:**

<CodeBlock 
  language="json"
  code={`{
  "type": "summary",
  "websiteId": "web_123",
  "startDate": "2024-01-01",
  "endDate": "2024-01-31"
}`}
/>

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "success": true,
  "data": {
    "sql": "SELECT date, count(*) as pageviews FROM analytics.events WHERE...",
    "parameters": ["web_123", "2024-01-01", "2024-01-31"]
  }
}`}
/>

## Custom SQL API

<Callout type="info">
  **New Feature!** ðŸš€ Use `properties.X` syntax for easy JSON property extraction. Write `properties.browser_name` instead of `JSONExtractString(properties, 'browser_name')`. Supports type annotations like `properties.user_id:int`, `properties.is_active:bool`.
</Callout>

### Execute Custom SQL Queries

Execute custom SQL queries directly against your ClickHouse analytics database with enterprise-grade security.

<CodeBlock 
  language="http"
  code="POST /v1/custom-sql/execute"
/>

**Authentication:**
- Requires API key with `write:custom-sql` or `read:analytics` scope
- API key must have `read:data` access to the specified `clientId`

**Request:**

<CodeBlock
  language="json"
  code={`{
  "query": "SELECT count() as events FROM analytics.events WHERE time >= now() - INTERVAL 7 DAY",
  "clientId": "your-client-id",
  "parameters": {
    "customParam": "value"
  }
}`}
/>

**Example with Properties.X Syntax:**

<CodeBlock
  language="json"
  code={`{
  "query": "SELECT properties.browser_name AS browser_name, properties.user_id:int AS user_id, count() as events FROM analytics.custom_events WHERE properties.browser_name IS NOT NULL GROUP BY properties.browser_name, properties.user_id:int ORDER BY events DESC LIMIT 10",
  "clientId": "your-client-id"
}`}
/>

**Headers:**

<CodeBlock 
  language="bash"
  code={`curl -X POST https://api.databuddy.cc/v1/custom-sql/execute \\
  -H "Content-Type: application/json" \\
  -H "x-api-key: dbdy_your_api_key_here" \\
  -d '{"query": "SELECT count() FROM analytics.events", "clientId": "client_123"}'`}
/>

**Available Tables:**
- `analytics.events` - All tracked events and page views
- `analytics.errors` - JavaScript errors and exceptions
- `analytics.custom_events` - Custom event tracking data
- `analytics.web_vitals` - Core Web Vitals performance metrics

**Properties.X Syntax Helper:**
Databuddy provides a convenient syntax helper that automatically converts `properties.X` notation to ClickHouse `JSONExtract` functions:

```sql
-- Instead of writing:
SELECT JSONExtractString(properties, 'browser_name') AS browser_name FROM analytics.events

-- You can simply write:
SELECT properties.browser_name AS browser_name FROM analytics.events
```

<Callout type="warning">
  **Important:** Always use `AS` aliases when selecting properties to get clean column names in your response. Without aliases, you'll get ugly column names like `"JSONExtractString(properties, 'browser_name')"` instead of `"browser_name"`.
</Callout>

**Supported Type Annotations:**
- `properties.property_name` â†’ `JSONExtractString(properties, 'property_name')` (default)
- `properties.user_id:int` â†’ `JSONExtractInt(properties, 'user_id')`
- `properties.is_active:bool` â†’ `JSONExtractBool(properties, 'is_active')`
- `properties.score:float` â†’ `JSONExtractFloat(properties, 'score')`
- `properties.metadata:raw` â†’ `JSONExtractRaw(properties, 'metadata')`

**Security Features:**
- **Automatic client isolation** - All queries automatically filtered by your API key's client access
- **Smart WHERE injection** - Client filtering added to your queries without breaking syntax
- SQL injection prevention with parameterized queries
- Query complexity limits (max 5 SELECT statements, 2 UNION operations, 5000 characters)
- Forbidden operations blocked (INSERT, UPDATE, DELETE, DROP, CREATE, ALTER, etc.)
- Attack pattern detection for known injection techniques
- Comments and multiple statements not allowed
- Balanced parentheses validation
- Properties.X syntax automatically transformed to secure JSONExtract calls

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "success": true,
  "data": [
    {
      "events": 15420
    }
  ],
  "meta": {
    "rowCount": 1,
    "columns": ["events"],
    "executionTime": 0.045,
    "rowsRead": 15420,
    "clientId": "client_123",
    "apiKeyId": "key_456"
  }
}`}
/>

### Get Custom SQL Schema

Get information about allowed tables, operations, and security constraints.

<CodeBlock 
  language="http"
  code="GET /v1/custom-sql/schema"
/>

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "success": true,
  "schema": {
    "allowedTables": [
      "analytics.events",
      "analytics.errors",
      "analytics.custom_events",
      "analytics.web_vitals"
    ],
    "allowedOperations": [
      "SELECT", "WITH", "FROM", "WHERE", "GROUP BY", "ORDER BY", "HAVING", "LIMIT", "OFFSET", "JOIN", "LEFT JOIN", "RIGHT JOIN", "INNER JOIN", "UNION", "UNION ALL", "JSONExtract", "JSONExtractString", "JSONExtractInt", "JSONExtractFloat", "JSONExtractBool", "JSONExtractRaw", "CASE", "WHEN", "THEN", "ELSE", "END", "AS", "AND", "OR", "NOT", "IN", "EXISTS", "BETWEEN", "LIKE", "ILIKE"
    ],
    "forbiddenOperations": [
      "INSERT", "UPDATE", "DELETE", "DROP", "CREATE", "ALTER", "TRUNCATE", "REPLACE", "MERGE", "CALL", "EXEC", "EXECUTE", "DECLARE", "SET", "USE", "SHOW", "DESCRIBE", "EXPLAIN", "ANALYZE", "OPTIMIZE", "REPAIR", "LOCK", "UNLOCK", "GRANT", "REVOKE", "COMMIT", "ROLLBACK", "SAVEPOINT", "RELEASE", "START TRANSACTION", "BEGIN", "INFORMATION_SCHEMA", "SYSTEM", "ADMIN", "SUPER", "FILE", "PROCESS", "RELOAD", "SHUTDOWN", "REFERENCES", "INDEX", "TRIGGER", "EVENT", "ROUTINE"
    ],
    "maxQueryLength": 5000,
    "maxNestedSelects": 5,
    "maxUnionOperations": 2,
    "parameterization": {
      "clientIdParameter": "{clientId:String}",
      "required": "All queries must use parameterized client filtering"
    },
    "propertiesSyntax": {
      "description": "Automatic JSONExtract transformation from properties.X syntax",
      "syntax": "properties.property_name[:type]",
      "supportedTypes": ["string", "int", "float", "bool", "raw"],
      "examples": [
        "properties.browser_name",
        "properties.user_id:int",
        "properties.is_active:bool",
        "properties.metadata:raw"
      ],
      "defaultType": "string (JSONExtractString)"
    }
  }
}`}
/>

### Get Query Examples

Get example queries to help you get started with custom SQL.

<CodeBlock 
  language="http"
  code="GET /v1/custom-sql/examples"
/>

**Response:**

<CodeBlock
  language="json"
  code={`{
  "success": true,
  "examples": [
    {
      "name": "Monthly Events Count",
      "description": "Get monthly event counts for your client",
      "query": "SELECT toStartOfMonth(time) as month_start, count() as event_count FROM analytics.events WHERE time >= now() - INTERVAL 6 MONTH GROUP BY month_start ORDER BY month_start DESC"
    },
    {
      "name": "Top Pages by Views",
      "description": "Get most popular pages",
      "query": "SELECT path, count() as page_views, uniq(session_id) as unique_sessions FROM analytics.events WHERE time >= now() - INTERVAL 30 DAY AND event_name = 'page_view' GROUP BY path ORDER BY page_views DESC LIMIT 10"
    },
    {
      "name": "Browser Analytics (with properties.X syntax)",
      "description": "Analyze browser usage using properties.X syntax",
      "query": "SELECT properties.browser_name, count() as events, uniq(anonymous_id) as unique_users FROM analytics.events WHERE time >= now() - INTERVAL 7 DAY AND properties.browser_name IS NOT NULL GROUP BY properties.browser_name ORDER BY events DESC"
    },
    {
      "name": "User Analytics with Typed Properties",
      "description": "Analyze user behavior with typed property extraction",
      "query": "SELECT properties.user_id:int as user_id, properties.is_premium:bool as is_premium, properties.session_duration:float as session_duration, count() as total_events FROM analytics.events WHERE time >= now() - INTERVAL 30 DAY AND properties.user_id:int IS NOT NULL GROUP BY properties.user_id:int, properties.is_premium:bool, properties.session_duration:float ORDER BY total_events DESC LIMIT 20"
    },
    {
      "name": "Error Events Analysis",
      "description": "Analyze error events",
      "query": "SELECT url, count() as error_count FROM analytics.errors WHERE time >= now() - INTERVAL 7 DAY GROUP BY url ORDER BY error_count DESC LIMIT 10"
    }
  ]
}`}
/>

**Error Responses:**

<CodeBlock 
  language="json"
  code={`{
  "success": false,
  "error": "API key does not have access to client ID: client_123",
  "code": "CLIENT_ACCESS_DENIED"
}`}
/>

**Common Error Codes:**
- `AUTH_REQUIRED` - API key missing or invalid
- `INSUFFICIENT_SCOPE` - API key lacks required scopes
- `CLIENT_ACCESS_DENIED` - No access to specified clientId
- `FORBIDDEN_OPERATION` - Query contains forbidden SQL operations
- `QUERY_TOO_COMPLEX` - Query exceeds complexity limits
- `ATTACK_PATTERN_DETECTED` - Query matches known attack patterns

## AI Assistant

### Stream Analytics Query

Use natural language to query your analytics data with streaming responses.

<CodeBlock 
  language="http"
  code="POST /v1/assistant/stream"
/>

**Request:**

<CodeBlock 
  language="json"
  code={`{
  "websiteId": "web_123",
  "message": "Show me the top pages by pageviews last week",
  "context": {
    "dateRange": {
      "start": "2024-01-01",
      "end": "2024-01-07"
    }
  }
}`}
/>

**Response (Server-Sent Events):**

<CodeBlock 
  language="json"
  code={`data: {"type": "thinking", "content": "Analyzing your page views..."}

data: {"type": "query", "content": "SELECT path, COUNT(*) as pageviews FROM analytics.events..."}

data: {"type": "complete", "content": "Here are your top pages:", "data": {"results": [{"path": "/", "pageviews": 1250}]}}`}
/>

## Data Export

### Export Analytics Data

Export analytics data in various formats (CSV, JSON).

<CodeBlock 
  language="http"
  code="POST /v1/export"
/>

**Request:**

<CodeBlock 
  language="json"
  code={`{
  "websiteId": "web_123",
  "type": "summary",
  "format": "csv",
  "startDate": "2024-01-01",
  "endDate": "2024-01-31",
  "timezone": "UTC"
}`}
/>

**Response:**
Returns a downloadable file in the requested format.

## Event Tracking

### Send Custom Events

Track custom events programmatically using the basket endpoint.

<CodeBlock 
  language="http"
  code="POST basket.databuddy.cc/?client_id={website_id}"
/>

**Single Custom Event Request:**

<CodeBlock 
  language="json"
  code={`{
  "type": "custom",
  "name": "purchase",
  "anonymousId": "anon_user_123",
  "sessionId": "session_456",
  "timestamp": 1704067200000,
  "properties": {
    "value": 99.99,
    "currency": "USD",
    "product_id": "prod_123"
  }
}`}
/>

**Minimal Custom Event (without session/user tracking):**

<CodeBlock 
  language="json"
  code={`{
  "type": "custom",
  "name": "newsletter_signup",
  "properties": {
    "source": "footer_form"
  }
}`}
/>

**Batch Custom Events Request:**

<CodeBlock 
  language="http"
  code="POST basket.databuddy.cc/batch?client_id={website_id}"
/>

<CodeBlock 
  language="json"
  code={`[
  {
    "type": "custom",
    "name": "purchase",
    "anonymousId": "anon_user_123",
    "sessionId": "session_456",
    "timestamp": 1704067200000,
    "properties": {
      "value": 99.99,
      "currency": "USD",
      "product_id": "prod_123"
    }
  },
  {
    "type": "custom",
    "name": "signup",
    "anonymousId": "anon_user_124",
    "sessionId": "session_457",
    "timestamp": 1704067260000,
    "properties": {
      "plan": "premium",
      "source": "landing_page"
    }
  }
]`}
/>

**Required Fields:**
- `type`: Must be "custom"
- `name`: Event name (1-128 characters)

**Optional Fields:**
- `anonymousId`: Anonymous user identifier (max 128 characters) - not needed for all use cases
- `sessionId`: Session identifier (max 128 characters) - not needed for all use cases
- `timestamp`: Unix timestamp in milliseconds (defaults to current time)
- `properties`: JSON object with custom event properties

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "status": "success",
  "type": "custom"
}`}
/>

**Batch Response:**

<CodeBlock 
  language="json"
  code={`{
  "status": "success",
  "batch": true,
  "processed": 2,
  "results": [
    {
      "status": "success",
      "type": "custom",
      "eventId": "evt_12345"
    },
    {
      "status": "success", 
      "type": "custom",
      "eventId": "evt_12346"
    }
  ]
}`}
/>

## Health Check

### API Health Status

Check the health status of the API and its dependencies.

<CodeBlock 
  language="http"
  code="GET /health"
/>

**Response:**

<CodeBlock 
  language="json"
  code={`{
  "clickhouse": true,
  "database": true,
  "redis": true,
  "success": true,
  "version": "1.0.0",
  "timestamp": "2024-01-01T12:00:00.000Z"
}`}
/>

## Rate Limits

API endpoints have different rate limits based on their computational cost and your subscription plan:

### Plan-Based Rate Limits

Rate limits vary by your subscription tier:

- **Free**: 50 requests per 10 seconds (300/minute)
- **Hobby**: 100 requests per 10 seconds (600/minute)  
- **Pro**: 200 requests per 10 seconds (1,200/minute)
- **Scale**: 500 requests per 10 seconds (3,000/minute)

### Endpoint-Specific Rate Limits

Certain endpoints have additional restrictions:

- **Public endpoints**: 100 requests per minute
- **Authentication endpoints**: 30 requests per minute
- **Custom SQL**: 30 requests per minute (heavy operations)

Rate limit headers are included in responses:

<CodeBlock 
  language="http"
  code={`X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1640995200`}
/>

## Error Handling

All errors follow a consistent format:

<CodeBlock 
  language="json"
  code={`{
  "success": false,
  "error": "Website not found or access denied",
  "code": "WEBSITE_NOT_FOUND"
}`}
/>

**Common Error Codes:**

- `AUTH_REQUIRED` - Authentication required
- `WEBSITE_NOT_FOUND` - Website not found or no access
- `INVALID_QUERY_TYPE` - Unknown query type
- `VALIDATION_ERROR` - Request validation failed
- `RATE_LIMIT_EXCEEDED` - Too many requests

## SDKs and Libraries

- **JavaScript/TypeScript**: `@databuddy/sdk`
- **Python**: Coming soon
- **Go**: Coming soon
- **PHP**: Coming soon