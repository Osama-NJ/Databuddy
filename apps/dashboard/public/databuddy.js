var I=(S,j)=>()=>(j||S((j={exports:{}}).exports,j),j.exports);var C=I((_,N)=>{(()=>{let z=(q)=>typeof q==="number"?Math.min(60000,Math.max(0,q)):q,X=()=>{},V=(q)=>{if(!q||q==="direct")return q;try{return new URL(q),q}catch{return null}},H=(q,B)=>{if(typeof q!=="number"||typeof B!=="number"||q<240||q>1e4||B<240||B>1e4)return{width:null,height:null};return{width:q,height:B}},O=(q,B,F)=>{if(q===void 0)return q;return Math.min(F,Math.max(B,q))};function W(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(q)=>{let B=Math.random()*16|0;return(q==="x"?B:B&3|8).toString(16)})}let T=class{constructor(q){this.baseUrl=q.baseUrl,this.staticHeaders={},this.dynamicHeaderFns={};let B={"Content-Type":"application/json",...q.defaultHeaders};for(let[F,G]of Object.entries(B))if(typeof G==="function"||G&&typeof G.then==="function")this.dynamicHeaderFns[F]=G;else this.staticHeaders[F]=G;this.maxRetries=q.maxRetries??3,this.initialRetryDelay=q.initialRetryDelay??500}async resolveHeaders(){let q={...this.staticHeaders};for(let[B,F]of Object.entries(this.dynamicHeaderFns))q[B]=await(typeof F==="function"?F():F);return q}addHeader(q,B){if(typeof B==="function"||B&&typeof B.then==="function")this.dynamicHeaderFns[q]=B,delete this.staticHeaders[q];else this.staticHeaders[q]=B,delete this.dynamicHeaderFns[q]}async post(q,B,F={},G=0){try{let J={method:"POST",headers:await this.resolveHeaders(),body:JSON.stringify(B??{}),keepalive:!0,credentials:"omit",...F},K=await fetch(q,J);if(K.status===401)return null;if(K.status!==200&&K.status!==202){if((K.status>=500&&K.status<600||K.status===429)&&G<this.maxRetries){let Q=Math.random()*0.3+0.85,M=this.initialRetryDelay*2**G*Q;return await new Promise((Y)=>setTimeout(Y,M)),this.post(q,B,F,G+1)}throw new Error(`HTTP error! status: ${K.status} for URL: ${q}`)}try{return await K.json()}catch(Q){let M=await K.text();return M?JSON.parse(M):null}}catch(J){let K=J.name==="TypeError"||J.name==="NetworkError";if(G<this.maxRetries&&K){let Q=Math.random()*0.3+0.85,M=this.initialRetryDelay*2**G*Q;return await new Promise((Y)=>setTimeout(Y,M)),this.post(q,B,F,G+1)}return null}}async fetch(q,B,F={}){let G=`${this.baseUrl}${q}`;return this.post(G,B,F,0)}},R=class{constructor(q){this.options={disabled:!1,trackScreenViews:!0,trackHashChanges:!1,trackAttributes:!1,trackOutgoingLinks:!1,trackSessions:!0,trackPerformance:!0,trackEngagement:!1,trackScrollDepth:!1,trackExitIntent:!1,trackInteractions:!1,trackErrors:!1,trackBounceRate:!1,samplingRate:1,enableRetries:!0,maxRetries:3,initialRetryDelay:500,enableBatching:!1,batchSize:10,batchTimeout:2000,...q},this.batchQueue=[],this.batchTimer=null;let B={"databuddy-client-id":this.options.clientId,"databuddy-sdk-name":this.options.sdk||"web","databuddy-sdk-version":this.options.sdkVersion||"1.0.0"};if(this.api=new T({baseUrl:this.options.apiUrl||"https://basket.databuddy.cc",defaultHeaders:B,maxRetries:this.options.maxRetries,initialRetryDelay:this.options.initialRetryDelay}),this.lastPath="",this.pageCount=0,this.isInternalNavigation=!1,this.anonymousId=this.getOrCreateAnonymousId(),this.sessionId=this.getOrCreateSessionId(),this.sessionStartTime=this.getSessionStartTime(),this.lastActivityTime=Date.now(),this.maxScrollDepth=0,this.interactionCount=0,this.hasExitIntent=!1,this.pageEngagementStart=Date.now(),this.utmParams=this.getUtmParams(),this.isLikelyBot=this.detectBot(),this.hasInteracted=!1,typeof window!=="undefined")this.setupBotDetection(),this.setupExitTracking()}getOrCreateAnonymousId(){if(typeof window!=="undefined"&&window.localStorage){let q=localStorage.getItem("did");if(q)return q;let B=this.generateAnonymousId();return localStorage.setItem("did",B),B}return this.generateAnonymousId()}generateAnonymousId(){return`anon_${W()}`}getOrCreateSessionId(){if(this.isServer())return this.generateSessionId();let q=sessionStorage.getItem("did_session"),B=sessionStorage.getItem("did_session_timestamp");if(q&&B){if(Date.now()-Number.parseInt(B,10)<1800000)return sessionStorage.setItem("did_session_timestamp",Date.now().toString()),q;sessionStorage.removeItem("did_session"),sessionStorage.removeItem("did_session_timestamp"),sessionStorage.removeItem("did_session_start")}let F=this.generateSessionId();return sessionStorage.setItem("did_session",F),sessionStorage.setItem("did_session_timestamp",Date.now().toString()),F}generateSessionId(){return`sess_${W()}`}getSessionStartTime(){if(this.isServer())return Date.now();let q=sessionStorage.getItem("did_session_start");if(q)return Number.parseInt(q,10);let B=Date.now();return sessionStorage.setItem("did_session_start",B.toString()),B}init(){if(this.isServer())return;if(this.options.trackSessions)this.anonymousId=this.getOrCreateAnonymousId(),this.sessionId=this.getOrCreateSessionId(),this.sessionStartTime=this.getSessionStartTime(),this.lastActivityTime=Date.now();else this.anonymousId=this.getOrCreateAnonymousId();let q=["mousedown","keydown","scroll","touchstart","click","keypress","mousemove"],B=()=>this.interactionCount++;if(this.options.trackInteractions)for(let F of q)window.addEventListener(F,B,{passive:!0});else{let F=()=>{this.interactionCount++;for(let G of q)window.removeEventListener(G,F)};for(let G of q)window.addEventListener(G,F,{passive:!0})}if(this.options.trackEngagement){if(this.maxScrollDepth=0,this.interactionCount=0,this.hasExitIntent=!1,this.options.trackExitIntent)document.addEventListener("mouseleave",(F)=>{if(F.clientY<=0)this.hasExitIntent=!0})}if(this.options.trackErrors)window.addEventListener("error",(F)=>{this.trackError({timestamp:Date.now(),message:F.message,filename:F.filename,lineno:F.lineno,colno:F.colno,stack:F.error?.stack,errorType:F.error?.name||"Error"})})}trackScrollDepth(){if(this.isServer())return;let q=document.documentElement.scrollHeight-window.innerHeight,B=window.scrollY,F=Math.min(100,Math.round(B/q*100));this.maxScrollDepth=Math.max(this.maxScrollDepth,F)}async send(q){let B=q.type==="track"&&q.payload?q.payload:q;if(this.options.disabled||this.options.filter&&!this.options.filter(B))return Promise.resolve();if(this.options.enableBatching&&!q.isForceSend)return this.addToBatch(B);let F={keepalive:!0};return this.api.fetch("/",B,F)}addToBatch(q){if(this.batchQueue.push(q),this.batchTimer===null)this.batchTimer=setTimeout(()=>this.flushBatch(),this.options.batchTimeout);if(this.batchQueue.length>=this.options.batchSize)this.flushBatch();return Promise.resolve()}async flushBatch(){if(this.batchTimer)clearTimeout(this.batchTimer),this.batchTimer=null;if(this.batchQueue.length===0)return;let q=[...this.batchQueue];this.batchQueue=[];try{let B={keepalive:!0},F=await this.sendBatchBeacon(q);if(F)return F;return await this.api.fetch("/batch",q,B)}catch(B){if(!B.status&&B.name==="TypeError")for(let G of q){let J={type:"track",payload:G,isForceSend:!0};this.send(J)}return null}}async sendBatchBeacon(q){if(this.isServer()||!navigator.sendBeacon)return null;try{let B=this.api.baseUrl,F=this.options.clientId,G=this.options.sdk||"web",J=this.options.sdkVersion||"1.0.0",K=`${B}/batch?client_id=${encodeURIComponent(F)}&sdk_name=${encodeURIComponent(G)}&sdk_version=${encodeURIComponent(J)}`,Q=JSON.stringify(q),M=new Blob([Q],{type:"application/json"});if(navigator.sendBeacon(K,M))return{success:!0}}catch(B){}return null}setGlobalProperties(q){this.global={...this.global,...q}}async track(q,B){if(this.options.disabled||this.isLikelyBot)return;if(this.options.samplingRate<1){if(Math.random()>this.options.samplingRate)return{sampled:!1}}let F;if(B===void 0||B===null)F={};else if(typeof B==="object")F=B;else F={value:B};let G=this.getBaseContext(),J={};if((q==="screen_view"||q==="page_view")&&!this.isServer()&&this.options.trackPerformance)J=this.collectNavigationTiming();let K={type:"track",payload:{eventId:W(),name:q,anonymousId:this.anonymousId,sessionId:this.sessionId,sessionStartTime:this.sessionStartTime,timestamp:Date.now(),...G,...J,properties:{...F}}};if(this.options.enableBatching)return this.send(K);try{let Q=await this.sendBeacon(K);if(Q)return Q}catch(Q){}return this.send(K)}async sendBeacon(q){if(this.isServer())return null;try{let B=q.type==="track"&&q.payload?q.payload:q;if(this.options.disabled||this.options.filter&&!this.options.filter(B))return null;let F=this.options.apiUrl;if(!F)return null;let G=this.options.clientId,J=this.options.sdk||"web",K=this.options.sdkVersion||"1.0.0",Q=new URL("/",F);Q.searchParams.set("client_id",G),Q.searchParams.set("sdk_name",J),Q.searchParams.set("sdk_version",K);let M=JSON.stringify(B);if(navigator.sendBeacon)try{let Y=new Blob([M],{type:"application/json"});if(navigator.sendBeacon(Q.toString(),Y))return{success:!0}}catch(Y){}return null}catch(B){return null}}clear(){if(this.anonymousId=this.generateAnonymousId(),typeof window!=="undefined"&&window.localStorage)localStorage.setItem("did",this.anonymousId);if(this.sessionId=this.generateSessionId(),this.sessionStartTime=Date.now(),this.lastActivityTime=this.sessionStartTime,!this.isServer())sessionStorage.setItem("did_session",this.sessionId),sessionStorage.setItem("did_session_start",this.sessionStartTime.toString())}flush(){if(this.options.enableBatching)this.flushBatch()}isServer(){return typeof document==="undefined"||typeof window==="undefined"||typeof localStorage==="undefined"}collectNavigationTiming(){if(this.isServer()||!this.options.trackPerformance)return{};try{let q=window.performance?.getEntriesByType("navigation")[0];if(!q)return{};return{load_time:z(Math.round(q.loadEventEnd)),dom_ready_time:z(Math.round(q.domContentLoadedEventEnd)),dom_interactive:z(Math.round(q.domInteractive)),ttfb:z(Math.round(q.responseStart-q.requestStart)),request_time:z(Math.round(q.responseEnd-q.requestStart)),render_time:Math.max(0,Math.round(q.domComplete-q.domContentLoadedEventEnd))}}catch(q){return{}}}getUtmParams(){if(typeof window==="undefined")return{};let q=new URLSearchParams(window.location.search);return{utm_source:q.get("utm_source"),utm_medium:q.get("utm_medium"),utm_campaign:q.get("utm_campaign"),utm_term:q.get("utm_term"),utm_content:q.get("utm_content")}}detectBot(){if(typeof window==="undefined")return!1;return navigator.webdriver||!navigator.plugins.length||!navigator.languages.length}setupBotDetection(){if(typeof window==="undefined")return;let q=()=>this.hasInteracted=!0;for(let B of["mousemove","scroll","keydown"])window.addEventListener(B,q,{once:!0,passive:!0})}setupExitTracking(){if(typeof window==="undefined")return;window.addEventListener("scroll",()=>{let B=document.documentElement.scrollHeight-window.innerHeight,F=window.scrollY,G=Math.min(100,Math.round(F/B*100));this.maxScrollDepth=Math.max(this.maxScrollDepth,G)},{passive:!0}),window.addEventListener("mouseout",(B)=>{if(B.clientY<=0)this.hasExitIntent=!0}),document.addEventListener("click",(B)=>{let F=B.target.closest("a[href]");if(F?.href)try{if(new URL(F.href).origin===window.location.origin)this.isInternalNavigation=!0}catch(G){}});for(let B of["popstate","pushstate","replacestate"])window.addEventListener(B,()=>{this.isInternalNavigation=!0});let q=()=>{if(this.options.enableBatching)this.flushBatch();this.trackExitData(),this.isInternalNavigation=!1};if(window.addEventListener("pagehide",q),!("onpagehide"in window))window.addEventListener("beforeunload",q)}trackExitData(){if(this.isServer())return;let q=this.getBaseContext(),B=`exit_${this.sessionId}_${btoa(window.location.pathname)}_${this.pageEngagementStart}`,F=Math.min(1e4,this.pageCount),G=Math.min(1e4,this.interactionCount),J=Math.min(86400,Math.round((Date.now()-this.pageEngagementStart)/1000)),K={type:"track",payload:{eventId:B,name:"page_exit",anonymousId:this.anonymousId,sessionId:this.sessionId,sessionStartTime:this.sessionStartTime,timestamp:Date.now(),...q,time_on_page:J,scroll_depth:Math.round(this.maxScrollDepth),interaction_count:G,has_exit_intent:this.hasExitIntent,page_count:F,is_bounce:F<=1?1:0}};this.sendExitEventImmediately(K)}async sendExitEventImmediately(q){try{let B=await this.sendBeacon(q);if(B)return B;return this.api.fetch("/",q,{keepalive:!0})}catch(B){return null}}getConnectionInfo(){let q=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!q)return{connection_type:null,rtt:null,downlink:null};return{connection_type:q.effectiveType||q.type||null,rtt:q.rtt||null,downlink:q.downlink||null}}getBaseContext(){if(this.isServer())return{};let q=this.getUtmParams(),B=this.getConnectionInfo(),{width:F,height:G}=H(window.innerWidth,window.innerHeight),J=F&&G?`${F}x${G}`:null,{width:K,height:Q}=H(window.screen.width,window.screen.height),M=K&&Q?`${K}x${Q}`:null,Y=V(this.global?.referrer||document.referrer||"direct");return{path:V(window.location.href),title:document.title,referrer:Y,screen_resolution:M,viewport_size:J,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,connection_type:B.connection_type,rtt:B.rtt,downlink:B.downlink,utm_source:q.utm_source,utm_medium:q.utm_medium,utm_campaign:q.utm_campaign,utm_term:q.utm_term,utm_content:q.utm_content}}async trackError(q){if(this.isServer())return;let B={type:"error",payload:{eventId:W(),anonymousId:this.anonymousId,sessionId:this.sessionId,timestamp:q.timestamp||Date.now(),path:window.location.pathname,message:q.message,filename:q.filename,lineno:q.lineno,colno:q.colno,stack:q.stack,errorType:q.errorType||"Error"}};if(this.options.enableBatching)return this.send(B);try{let F=await this.sendBeacon(B);if(F)return F}catch(F){}return this.send(B)}};function x(q){return q.replace(/([-_][a-z])/gi,(B)=>B.toUpperCase().replace("-","").replace("_",""))}let A=class extends R{constructor(q){super({sdk:"web",sdkVersion:"1.0.2",...q});if(this.isServer())return;if(this.options.trackScreenViews)this.trackScreenViews(),setTimeout(()=>this.screenView(),0);if(this.options.trackOutgoingLinks)this.trackOutgoingLinks();if(this.options.trackAttributes)this.trackAttributes();this.init()}debounce(q,B){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(q,B)}trackOutgoingLinks(){this.isServer()||document.addEventListener("click",(q)=>{let B=q.target,F=B.closest("a");if(F&&B){let G=F.getAttribute("href");if(G)try{if(new URL(G,window.location.origin).origin!==window.location.origin)this.track("link_out",{href:G,text:F.innerText||F.getAttribute("title")||B.getAttribute("alt")})}catch(J){}}})}trackScreenViews(){if(this.isServer())return;let q=history.pushState;history.pushState=function(...G){let J=q.apply(this,G);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),J};let B=history.replaceState;history.replaceState=function(...G){let J=B.apply(this,G);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),J},window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))}),this.pageEngagementStart=Date.now();let F=()=>this.debounce(()=>{let G=this.lastPath||window.location.href;this.setGlobalProperties({referrer:G}),this.isInternalNavigation=!0,this.screenView()},50);this.options.trackHashChanges?window.addEventListener("hashchange",F):window.addEventListener("locationchange",F)}trackAttributes(){this.isServer()||document.addEventListener("click",(q)=>{let B=q.target,F=B.closest("button"),G=B.closest("a"),J=F?.getAttribute("data-track")?F:G?.getAttribute("data-track")?G:null;if(J){let K={};for(let M of J.attributes)if(M.name.startsWith("data-")&&M.name!=="data-track")K[x(M.name.replace(/^data-/,""))]=M.value;let Q=J.getAttribute("data-track");Q&&this.track(Q,K)}})}screenView(q,B){if(this.isServer())return;let F,G;if(this.lastPath&&this.pageEngagementStart&&this.options.trackEngagement)this.maxScrollDepth=0,this.interactionCount=0,this.hasExitIntent=!1;if(this.pageEngagementStart=Date.now(),typeof q==="string")F=q,G=B;else F=window.location.href,G=q;if(this.lastPath!==F){this.lastPath=F,this.pageCount++,this.isInternalNavigation=!1;let J={page_count:Math.min(1e4,this.pageCount),...G??{}};this.track("screen_view",J)}}};function U(){if(typeof window==="undefined"||window.databuddy)return;try{if(localStorage.getItem("databuddy_opt_out")==="true"||localStorage.getItem("databuddy_disabled")==="true"||window.databuddyOptedOut===!0||window.databuddyDisabled===!0){window.databuddy={track:X,screenView:X,clear:X,flush:X,setGlobalProperties:X,trackCustomEvent:X,options:{disabled:!0}},window.db={track:X,screenView:X,clear:X,flush:X,setGlobalProperties:X,trackCustomEvent:X};return}}catch(J){}let q=document.currentScript||(()=>{let J=document.getElementsByTagName("script");return J[J.length-1]})();function B(){let J=window.databuddyConfig||{};if(!q)return J;let K={};for(let Y of q.attributes)if(Y.name.startsWith("data-")){let $=Y.name.substring(5).replace(/-([a-z])/g,(L,w)=>w.toUpperCase()),Z=Y.value;if(Z==="true")K[$]=!0;else if(Z==="false")K[$]=!1;else if(/^\d+$/.test(Z))K[$]=Number(Z);else K[$]=Z}let Q={};try{let Y=new URL(q.src);new URLSearchParams(Y.search).forEach((Z,L)=>{if(Z==="true")Q[L]=!0;else if(Z==="false")Q[L]=!1;else if(/^\d+$/.test(Z))Q[L]=Number(Z);else Q[L]=Z})}catch(Y){}let M={...J,...Q,...K};if(M.samplingRate!==void 0){if(M.samplingRate<0)M.samplingRate=0;if(M.samplingRate>1)M.samplingRate=1}if(M.maxRetries!==void 0&&M.maxRetries<0)M.maxRetries=0;if(M.initialRetryDelay=O(M.initialRetryDelay,50,1e4),M.batchSize=O(M.batchSize,1,50),M.batchTimeout=O(M.batchTimeout,100,30000),M.apiUrl)try{new URL(M.apiUrl)}catch(Y){M.apiUrl="https://basket.databuddy.cc"}else M.apiUrl="https://basket.databuddy.cc";return M}function F(J){if(J.clientId)return J.clientId;if(q?.getAttribute("data-client-id"))return q.getAttribute("data-client-id");return null}function G(){if(window.databuddy)return;let J=B(),K=F(J);if(!K)return;window.databuddy=new A({...J,clientId:K}),window.db={track:(...Q)=>window.databuddy?.track(...Q),screenView:(...Q)=>window.databuddy?.screenView(...Q),clear:()=>window.databuddy?.clear(),flush:()=>window.databuddy?.flush(),setGlobalProperties:(...Q)=>window.databuddy?.setGlobalProperties(...Q),trackCustomEvent:(...Q)=>window.databuddy?.trackCustomEvent(...Q)}}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",G);else G()}if(U(),typeof window!=="undefined"){window.Databuddy=A,window.databuddyOptOut=()=>{try{localStorage.setItem("databuddy_opt_out","true"),localStorage.setItem("databuddy_disabled","true")}catch(q){}if(window.databuddyOptedOut=!0,window.databuddyDisabled=!0,window.databuddy&&typeof window.databuddy==="object")window.databuddy.options.disabled=!0,window.databuddy.track=X,window.databuddy.screenView=X,window.databuddy.trackCustomEvent=X,window.databuddy.clear=X,window.databuddy.flush=X,window.databuddy.setGlobalProperties=X;if(window.db)window.db.track=X,window.db.screenView=X,window.db.trackCustomEvent=X,window.db.clear=X,window.db.flush=X,window.db.setGlobalProperties=X;console.log("Databuddy: Tracking has been disabled. Reload the page for full effect.")},window.databuddyOptIn=()=>{try{localStorage.removeItem("databuddy_opt_out"),localStorage.removeItem("databuddy_disabled")}catch(q){}window.databuddyOptedOut=!1,window.databuddyDisabled=!1,console.log("Databuddy: Tracking has been enabled. Reload the page for full effect.")};try{let q=new URLSearchParams(window.location.search);if(q.get("databuddy_opt_out")==="true"||q.get("no_tracking")==="true")window.databuddyOptOut()}catch(q){}}else if(typeof _==="object")N.exports=A})()});export default C();
